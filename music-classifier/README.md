# Music Classifier API

API –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º BERT-—ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ XGBoost –º–æ–¥–µ–ª–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤–µ–±-API –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—É–¥–∏–æ-—Ñ–∏—á –∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Ç—Ä–µ–∫–æ–≤. API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å XGBoost –∏ BERT-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üéµ –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞
- üì¶ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
- üîç Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API
- üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
music-classifier/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ xgb_pipe.joblib  # –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ start.sh         # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ test_api.py          # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ requirements.txt     # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   cd music-classifier
   pip install -r requirements.txt
   ```

2. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   python app/main.py
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
   ```bash
   python test_api.py
   ```

### Docker –∑–∞–ø—É—Å–∫

1. **–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å Docker Compose:**
   ```bash
   cd music-classifier
   docker-compose up --build
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
   ```bash
   python test_api.py
   ```

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Health Check
```
GET /health
```
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ API –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "OK",
  "model_loaded": true,
  "embedding_model_loaded": true
}
```

### –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```
POST /predict
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "artist": "The Beatles",
  "track": "Hey Jude",
  "decade_of_release": 1960,
  "danceability": 0.5,
  "energy": 0.7,
  "key": 7,
  "loudness": -8.5,
  "mode": 1,
  "speechiness": 0.03,
  "acousticness": 0.2,
  "instrumentalness": 0.0,
  "liveness": 0.1,
  "valence": 0.8,
  "tempo": 120.0,
  "duration_ms": 431000,
  "time_signature": 4,
  "chorus_hit": 0.5,
  "sections": 8
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "prediction": 1,
  "probabilities": [0.2, 0.8],
  "track_embedding_dim": 384
}
```

### –ü–∞–∫–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```
POST /batch_predict
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "items": [
    {
      "artist": "Queen",
      "track": "Bohemian Rhapsody",
      "decade_of_release": 1970,
      "danceability": 0.3,
      "energy": 0.6,
      "key": 0,
      "loudness": -7.2,
      "mode": 1,
      "speechiness": 0.05,
      "acousticness": 0.1,
      "instrumentalness": 0.0,
      "liveness": 0.2,
      "valence": 0.4,
      "tempo": 72.0,
      "duration_ms": 355000,
      "time_signature": 4,
      "chorus_hit": 0.3,
      "sections": 12
    }
  ]
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "results": [
    {
      "prediction": 0,
      "probabilities": [0.7, 0.3],
      "track": "Bohemian Rhapsody"
    }
  ]
}
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `artist` | string | –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å |
| `track` | string | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ |
| `decade_of_release` | integer | –î–µ–∫–∞–¥–∞ –≤—ã–ø—É—Å–∫–∞ (1960, 1970, etc.) |
| `danceability` | float | –¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–æ—Å—Ç—å (0.0-1.0) |
| `energy` | float | –≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å (0.0-1.0) |
| `key` | integer | –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á (0-11) |
| `loudness` | float | –ì—Ä–æ–º–∫–æ—Å—Ç—å –≤ –¥–ë |
| `mode` | integer | –õ–∞–¥ (0=–º–∏–Ω–æ—Ä, 1=–º–∞–∂–æ—Ä) |
| `speechiness` | float | –†–µ—á–µ–≤–æ—Å—Ç—å (0.0-1.0) |
| `acousticness` | float | –ê–∫—É—Å—Ç–∏—á–Ω–æ—Å—Ç—å (0.0-1.0) |
| `instrumentalness` | float | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å (0.0-1.0) |
| `liveness` | float | –ñ–∏–≤–æ—Å—Ç—å (0.0-1.0) |
| `valence` | float | –ü–æ–∑–∏—Ç–∏–≤–Ω–æ—Å—Ç—å (0.0-1.0) |
| `tempo` | float | –¢–µ–º–ø –≤ BPM |
| `duration_ms` | integer | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö |
| `time_signature` | integer | –†–∞–∑–º–µ—Ä (3, 4, 5, etc.) |
| `chorus_hit` | float | –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –ø—Ä–∏–ø–µ–≤ |
| `sections` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—Ü–∏–π |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:

```bash
python test_api.py
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

API –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è health check —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ML –º–æ–¥–µ–ª–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** - –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API
- **XGBoost** - –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
- **Sentence Transformers** - BERT-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- **Pandas** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **Docker** - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Uvicorn** - ASGI —Å–µ—Ä–≤–µ—Ä

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö.


